
<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Quáº£n lÃ½ váº­t tÆ°</title>
<style>
body { font-family: Arial; padding: 20px; }
.container { display: flex; gap: 20px; }
.box { flex: 1; border: 1px solid #ccc; padding: 15px; border-radius: 6px; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
th { background: #eee; }
input, select, button { width: 100%; padding: 6px; margin: 5px 0; }
button { cursor: pointer; }
</style>
</head>

<body>
<h1>ğŸ“¦ QUáº¢N LÃ Váº¬T TÆ¯</h1>

<div class="container">
<div class="box">
<h3>â• ThÃªm váº­t tÆ° má»›i</h3>
<input id="newName" placeholder="TÃªn váº­t tÆ°">
<input id="newQty" type="number" placeholder="Sá»‘ lÆ°á»£ng ban Ä‘áº§u">
<button onclick="addItem()">ThÃªm váº­t tÆ°</button>

<hr>

<h3>ğŸ”„ Nháº­p / Xuáº¥t</h3>
<select id="itemSelect"></select>
<select id="sign">
  <option value="+">Nháº­p (+)</option>
  <option value="-">Xuáº¥t (-)</option>
</select>
<input id="qty" type="number" placeholder="Sá»‘ lÆ°á»£ng">
<input id="noteLine" placeholder="Ghi chÃº dÃ²ng">
<button onclick="addTemp()">ThÃªm táº¡m</button>
</div>

<div class="box">
<h3>ğŸ“‹ Danh sÃ¡ch táº¡m</h3>
<table>
<tr><th>Váº­t tÆ°</th><th>SL</th><th>Ghi chÃº</th><th>XÃ³a</th></tr>
<tbody id="tempTable"></tbody>
</table>

<input id="logNote" placeholder="Ghi chÃº chung">
<button onclick="saveToSheet()">ğŸ’¾ LÆ¯U VÃ€O KHO</button>
</div>
</div>

<hr>

<h3>ğŸ“Š Tá»“n kho (trÃªn web)</h3>
<table>
<tr><th>Váº­t tÆ°</th><th>Sá»‘ lÆ°á»£ng</th></tr>
<tbody id="mainTable"></tbody>
</table>

<script>
/* ====== DÃN LINK WEB APP ====== */
const API_URL = "https://script.google.com/macros/s/AKfycbymB4cBl0LtSm7lZDhhqn3ll4oYCrIrOjIPK4oxzrc8Rw9PLPuZgoVpD1db3db6ZmwyqQ/exec";

/* ====== Dá»® LIá»†U ====== */
let inventory = [];
let temp = [];

/* ====== HIá»‚N THá»Š ====== */
function render() {
  itemSelect.innerHTML = "";
  mainTable.innerHTML = "";
  tempTable.innerHTML = "";

  inventory.forEach((i, idx) => {
    itemSelect.innerHTML += `<option value="${idx}">${i.name}</option>`;
    mainTable.innerHTML += `<tr><td>${i.name}</td><td>${i.qty}</td></tr>`;
  });

  temp.forEach((t, i) => {
    tempTable.innerHTML += `
      <tr>
        <td>${t.name}</td>
        <td>${t.sign}${t.qty}</td>
        <td>${t.note}</td>
        <td><button onclick="temp.splice(${i},1);render()">âŒ</button></td>
      </tr>`;
  });
}

/* ====== THÃŠM Váº¬T TÆ¯ Má»šI ====== */
function addItem() {
  const name = newName.value.trim();
  const qty = Number(newQty.value);

  if (!name || qty <= 0) {
    alert("Thiáº¿u dá»¯ liá»‡u");
    return;
  }

  inventory.push({ name, qty });

  fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      note: "ThÃªm váº­t tÆ° má»›i",
      items: [{ name, sign: "+", qty }]
    })
  });

  newName.value = newQty.value = "";
  render();
}

/* ====== THÃŠM NHáº¬P/XUáº¤T Táº M ====== */
function addTemp() {
  const idx = itemSelect.value;
  const q = Number(qty.value);

  if (q <= 0) {
    alert("Sai sá»‘ lÆ°á»£ng");
    return;
  }

  temp.push({
    name: inventory[idx].name,
    sign: sign.value,
    qty: q,
    note: noteLine.value
  });

  qty.value = noteLine.value = "";
  render();
}

/* ====== LÆ¯U VÃ€O GOOGLE SHEET ====== */
function saveToSheet() {
  if (temp.length === 0) {
    alert("ChÆ°a cÃ³ dá»¯ liá»‡u");
    return;
  }

  temp.forEach(t => {
    const item = inventory.find(i => i.name === t.name);
    item.qty += t.sign === "+" ? t.qty : -t.qty;
  });

  fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      note: logNote.value,
      items: temp
    })
  })
  .then(() => alert("ÄÃ£ lÆ°u vÃ o Sheet"))
  .catch(() => alert("Lá»—i káº¿t ná»‘i"));

  temp = [];
  logNote.value = "";
  render();
}
</script>

</body>
</html>


