<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Qu·∫£n l√Ω v·∫≠t t∆∞</title>

<style>
body { font-family: Arial; padding: 20px; }
.container { display: flex; gap: 20px; }
.box { flex: 1; border: 1px solid #ccc; padding: 15px; border-radius: 6px; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
th { background: #eee; }
input, select, button { padding: 6px; margin: 4px; }
button { cursor: pointer; }
.edit { background: #fff3cd; }
</style>
</head>

<body>

<h1>üì¶ QU·∫¢N L√ù V·∫¨T T∆Ø</h1>

<div class="container">
  <div class="box">
    <h3>‚ûï Th√™m v·∫≠t t∆∞ m·ªõi</h3>
    <input id="newName" placeholder="T√™n v·∫≠t t∆∞">
    <input id="newQty" type="number" placeholder="S·ªë l∆∞·ª£ng ban ƒë·∫ßu">
    <button onclick="addItem()">Th√™m</button>

    <hr>

    <h3>üîÑ Nh·∫≠p / Xu·∫•t</h3>
    <select id="itemSelect"></select>
    <select id="sign">
      <option value="NH·∫¨P">Nh·∫≠p</option>
      <option value="XU·∫§T">Xu·∫•t</option>
    </select>
    <input id="qty" type="number" placeholder="S·ªë l∆∞·ª£ng">
    <input id="noteLine" placeholder="Ghi ch√∫">
    <button onclick="addLog()">Ghi nh·∫≠t k√Ω</button>
  </div>

  <div class="box">
    <h3>üìä T·ªíN KHO (CH·ªà HI·ªÇN TH·ªä)</h3>
    <table>
      <thead>
        <tr><th>V·∫≠t t∆∞</th><th>S·ªë l∆∞·ª£ng</th></tr>
      </thead>
      <tbody id="inventoryTable"></tbody>
    </table>
  </div>
</div>

<hr>

<h3>üìú L·ªäCH S·ª¨ NH·∫¨P / XU·∫§T (C√ì TH·ªÇ S·ª¨A)</h3>
<table>
<thead>
<tr>
  <th>Th·ªùi gian</th>
  <th>V·∫≠t t∆∞</th>
  <th>Lo·∫°i</th>
  <th>S·ªë l∆∞·ª£ng</th>
  <th>Ghi ch√∫</th>
  <th>L∆∞u</th>
</tr>
</thead>
<tbody id="logTable"></tbody>
</table>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbz0C6y89gmcTOK3mtJt52UN9VJ9ZPe5TLPlERhRUE0dVgGuYUsSalLF43kca6xTmxbWfQ/exec";

/* ===== DATA ===== */
let inventory = [];
let logs = [];

/* ===== LOAD KHI M·ªû WEB ===== */
window.onload = () => {
  loadInventory();
  loadLogs();
};

/* ===== LOAD T·ªíN KHO ===== */
async function loadInventory() {
  const res = await fetch(API_URL + "?action=getInventory");
  inventory = await res.json();

  inventoryTable.innerHTML = "";
  itemSelect.innerHTML = "";

  inventory.forEach((i, idx) => {
    inventoryTable.innerHTML += `<tr><td>${i.name}</td><td>${i.qty}</td></tr>`;
    itemSelect.innerHTML += `<option value="${i.name}">${i.name}</option>`;
  });
}

/* ===== LOAD NH·∫¨T K√ù ===== */
async function loadLogs() {
  const res = await fetch(API_URL + "?action=getLogs");
  logs = await res.json();

  logTable.innerHTML = "";
  logs.forEach((l, i) => {
    logTable.innerHTML += `
    <tr class="edit">
      <td>${l.time}</td>
      <td><input value="${l.name}" id="name${i}"></td>
      <td>
        <select id="type${i}">
          <option ${l.type==="NH·∫¨P"?"selected":""}>NH·∫¨P</option>
          <option ${l.type==="XU·∫§T"?"selected":""}>XU·∫§T</option>
        </select>
      </td>
      <td><input type="number" value="${l.qty}" id="qty${i}"></td>
      <td><input value="${l.note}" id="note${i}"></td>
      <td><button onclick="updateLog(${i})">üíæ</button></td>
    </tr>`;
  });
}

/* ===== TH√äM V·∫¨T T∆Ø ===== */
async function addItem() {
  await fetch(API_URL, {
    method: "POST",
    body: new URLSearchParams({
      action: "addItem",
      name: newName.value,
      qty: newQty.value
    })
  });
  newName.value = newQty.value = "";
  loadInventory();
}

/* ===== GHI NH·∫¨T K√ù ===== */
async function addLog() {
  await fetch(API_URL, {
    method: "POST",
    body: new URLSearchParams({
      action: "addLog",
      name: itemSelect.value,
      type: sign.value,
      qty: qty.value,
      note: noteLine.value
    })
  });
  qty.value = noteLine.value = "";
  loadInventory();
  loadLogs();
}

/* ===== S·ª¨A NH·∫¨T K√ù ===== */
async function updateLog(i) {
  await fetch(API_URL, {
    method: "POST",
    body: new URLSearchParams({
      action: "updateLog",
      row: logs[i].row,
      name: document.getElementById("name"+i).value,
      type: document.getElementById("type"+i).value,
      qty: document.getElementById("qty"+i).value,
      note: document.getElementById("note"+i).value
    })
  });
  alert("ƒê√£ c·∫≠p nh·∫≠t");
  loadInventory();
  loadLogs();
}
</script>

</body>
</html>
